#!/bin/bash

if [[ ! -f ./releaser ]];then
  wget http://http.archive.ai-traders.com/releaser/0.3.0/releaser || { echo "failed to wget releaser"; exit 1; }
fi
source ./releaser
releaser_init

command="$1"
case "${command}" in
  bump)
      bump_changelog_and_oversion "$2"
      exit $?
      ;;
  verify_version)
      verify_version_no_version_file
      exit $?
      ;;
  itest)
      time bats ./test/integration/*.bats
      exit $?
      ;;
  release)
      verify_version_no_version_file
      git_tag_from_oversion
      exit $?
      ;;
  publish)
      # publish the just released version
      version=$(get_last_git_tagged_version)
      publish_to_archive "docker-ops" "${version}" "src/docker-ops"
      exit $?
      ;;
  *)
      echo "Invalid command: '${command}'"
      return 1
      ;;
esac
